# Gratefully stolen from https://github.com/ratatui-org/ratatui/blob/main/cliff.toml,
# albeit edited.

[remote.github]
owner = "Froloket64"
repo = "lifers-raylib"

[changelog]
header = """
# Changelog

All notable changes to this project will be documented in this file.

"""

body = """
{% if version %}\
    ## [{{ version }}] - {{ timestamp | date(format="%Y-%m-%d") }}
{% else %}\
    ## [unreleased]
{% endif -%}

{% for group, commits in commits | group_by(attribute="group") %}
    ### {{ group | striptags | trim | upper_first }}
    {% for commit in commits | filter(attribute="scope") %}
        {{ self::commit(commit=commit) }}
    {%- endfor -%}

    {% for commit in commits %}
        {%- if not commit.scope %}
            {{ self::commit(commit=commit) }}
        {%- endif -%}
    {% endfor %}
{% endfor -%}\n

{%- macro commit(commit) -%}
- [_{{ commit.id | truncate(length=7, end="") }}_]({{ "https://github.com/Froloket64/lifers-raylib/commit/" ~ commit.id }}) \
  _({{commit.scope }})_ {{ commit.message | upper_first | trim }} \
  _({% if commit.github.username %}@{{ commit.github.username }}{%- endif -%}\
  {% if commit.github.pr_number %} in [#{{ commit.github.pr_number }}]({{ self::remote_url() }}/pull/{{ commit.github.pr_number }}){%- endif %})_\
{%- if commit.breaking %} [**breaking**]{% endif %}
{%- if commit.body %}

    ````text {#- 4 backticks escape any backticks in body #}
    {{ commit.body | indent(prefix="  ") }}
    ````
{%- endif %}
{%- for footer in commit.footers %}
    {{ footer.token | indent(prefix="  ") }}{{ footer.separator }}{{ footer.value }}
{%- endfor %}
{%- endmacro %}

"""

footer = """
<!-- generated by git-cliff -->
"""

trim = true
postprocessors = []

[git]
conventional_commits = true
filter_unconventional = true
# process each line of a commit as an individual commit
split_commits = false
# regex for preprocessing the commit messages
commit_preprocessors = [
  # Replace issue numbers
  #{ pattern = '\((\w+\s)?#([0-9]+)\)', replace = "([#${2}](<REPO>/issues/${2}))"},
  # Check spelling of the commit with https://github.com/crate-ci/typos
  # If the spelling is incorrect, it will be automatically fixed.
  #{ pattern = '.*', replace_command = 'typos --write-changes -' },
]
# regex for parsing and grouping commits
commit_parsers = [
  { message = "^feat", group = "ğŸš€ Features" },
  { message = "^fix", group = "ğŸ› Bug Fixes" },
  { message = "^docs", group = "ğŸ“š Documentation" },
  { message = "^perf", group = "âš¡ Performance" },
  { message = "^refactor", group = "ğŸšœ Refactoring" },
  { message = "^style", group = "ğŸ¨ Styling" },
  { message = "^test", group = "ğŸ§ª Testing" },
  { message = "^chore\\(release\\): [Pp]repare for", skip = true },
  { message = "^chore\\(deps.*\\)", skip = true },
  { message = "^chore\\(pr\\)", skip = true },
  { message = "^chore\\(pull\\)", skip = true },
  { message = "^chore|^ci", group = "âš™ï¸ Miscellaneous" },
  { body = ".*security", group = "ğŸ›¡ï¸ Security" },
  { message = "^revert", group = "â—€ï¸ Revert" },
]
# protect breaking changes from being skipped due to matching a skipping commit_parser
protect_breaking_commits = false
# filter out the commits that are not matched by commit parsers
filter_commits = false
# regex for matching git tags
tag_pattern = "v[0-9].*"
# regex for skipping tags
# skip_tags = ""
# regex for ignoring tags
# ignore_tags = ""
# sort the tags topologically
topo_order = false
# sort the commits inside sections by oldest/newest order
sort_commits = "oldest"
# limit the number of commits included in the changelog.
# limit_commits = 42
